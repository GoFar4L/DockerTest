# Events block: Configures worker connections for NGINX
events {
    worker_connections 1024; # Maximum number of simultaneous connections per worker process
}

# HTTP block: Contains all HTTP/HTTPS server configurations
http {
    # Enable sending of files (e.g., for static assets) efficiently
    sendfile on;

    # Optimize TCP connections
    tcp_nopush on;
    tcp_nodelay on;

    # Set timeout for client connections
    keepalive_timeout 65;

    # MIME types configuration
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Logging settings
    access_log /var/log/nginx/access.log; # Access log location
    error_log /var/log/nginx/error.log;   # Error log location

    # Server block: Defines a virtual server for HTTPS traffic
    server {
        listen 443 ssl; # Listen on port 443 with SSL
        server_name localhost; # Server name (use your domain or IP in production)

        # SSL certificate paths (self-signed or from a CA)
        ssl_certificate /etc/nginx/certs/selfsigned.crt;     # Path to SSL certificate
        ssl_certificate_key /etc/nginx/certs/selfsigned.key; # Path to SSL private key

        # Optional: SSL settings for better security
#         ssl_protocols TLSv1.2 TLSv1.3; # Supported TLS versions
#         ssl_prefer_server_ciphers on;  # Prefer server-specified ciphers
#         ssl_ciphers HIGH:!aNULL:!MD5;  # Use strong ciphers

        # Root location block: Proxy requests to WordPress container
        location / {
            proxy_pass http://wordpress:80; # Forward requests to WordPress container on port 80
            proxy_set_header Host $host;    # Pass the original host header
            proxy_set_header X-Real-IP $remote_addr; # Pass the client's IP
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # Pass the client's IP chain
            proxy_set_header X-Forwarded-Proto $scheme; # Pass the protocol (http/https)
        }

        # Optional: Serve static files directly (if WordPress has static assets)
        location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf|svg|eot)$ {
            root /var/www/html; # Adjust path to where WordPress static files are stored
            expires max;        # Cache static files for a long time
            log_not_found off;  # Avoid logging missing static files
        }

        # Optional: Deny access to sensitive files
        location ~* \.(env|ini|log|conf)$ {
            deny all; # Prevent access to sensitive configuration files
        }
    }

    # Optional: HTTP server block to redirect HTTP to HTTPS
    server {
        listen 80;
        server_name localhost;

        # Redirect all HTTP traffic to HTTPS
        return 301 https://$host$request_uri;
    }
}